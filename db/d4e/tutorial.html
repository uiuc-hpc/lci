<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LCI: Tutorial</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../custom.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/uiuc-hpc/lci" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
  <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
  <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">LCI<span id="projectnumber">&#160;v2.0.0-dev</span>
   </div>
   <div id="projectbrief">For Asynchronous Multithreaded Communication</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('db/d4e/tutorial.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md42">Add LCI to your project</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md43">Install LCI</a>
    <ul>
      <li class="level2">
        <a href="#autotoc_md44">Prerequisites</a>
      </li>
      <li class="level2">
        <a href="#autotoc_md45">With CMake</a>
        <ul>
          <li class="level3">
            <a href="#autotoc_md46">Install LCI on your laptop</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md47">Install LCI on a cluster</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md48">Important CMake variables</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#autotoc_md49">With Spack</a>
        <ul>
          <li class="level3">
            <a href="#autotoc_md50">Important Spack variables</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#autotoc_md51">Write LCI programs</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md52">Run LCI applications</a>
    <ul>
      <li class="level2 empty">
        <ul>
          <li class="level3">
            <a href="#autotoc_md53">Bootstrapping backends</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md54">Launchers</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md55">More about the file backend</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md42"></a>
Add LCI to your project</h1>
<p>The following CMake code will add LCI to your project. It will first try to find LCI on your system. If it is not found, it will download and build LCI from GitHub.</p>
<div class="fragment"><div class="line"># Try to find LCI externally</div>
<div class="line">find_package(</div>
<div class="line">  LCI</div>
<div class="line">  CONFIG</div>
<div class="line">  PATH_SUFFIXES</div>
<div class="line">  lib/cmake</div>
<div class="line">  lib64/cmake)</div>
<div class="line">if(NOT LCI_FOUND)</div>
<div class="line">  message(STATUS &quot;Existing LCI installation not found. Try FetchContent.&quot;)</div>
<div class="line">  include(FetchContent)</div>
<div class="line">  FetchContent_Declare(</div>
<div class="line">    lci</div>
<div class="line">    GIT_REPOSITORY https://github.com/uiuc-hpc/lci.git</div>
<div class="line">    GIT_TAG master)</div>
<div class="line">  FetchContent_MakeAvailable(lci)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line"># Link LCI to your target</div>
<div class="line">target_link_libraries(your_target PRIVATE LCI::lci)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md43"></a>
Install LCI</h1>
<p>Although CMake FetchContent is convenient, you may also want to install LCI on your systems.</p>
<h2><a class="anchor" id="autotoc_md44"></a>
Prerequisites</h2>
<ul>
<li>A Linux or MacOS laptop or cluster.</li>
<li>A C++ compiler that supports C++17 or higher (GCC 8 or higher, Clang 5 or higher, etc).</li>
<li>CMake 3.12 or higher.</li>
<li>A network backend that supports LCI. Currently, LCI supports:<ul>
<li><a href="https://github.com/linux-rdma/rdma-core/blob/master/Documentation/libibverbs.md">libibverbs</a>. Typically for Infiniband/RoCE.</li>
<li><a href="https://ofiwg.github.io/libfabric/">libfabric</a>. For Slingshot-11, Ethernet, shared memory (including laptop), and other networks.</li>
</ul>
</li>
</ul>
<p>Normal clusters should already have these installed (you may need a few <code>module load</code>). If you are using a laptop, you may need to install cmake and libfabric manually.</p><ul>
<li>For Ubuntu, you can install the prerequisites using: <div class="fragment"><div class="line">sudo apt-get install -y cmake libfabric-bin libfabric-dev</div>
</div><!-- fragment --></li>
<li>For MacOS, you can install the prerequisites using: <div class="fragment"><div class="line">brew install cmake libfabric</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md45"></a>
With CMake</h2>
<h3><a class="anchor" id="autotoc_md46"></a>
Install LCI on your laptop</h3>
<div class="fragment"><div class="line">git clone https://github.com/uiuc-hpc/lci.git</div>
<div class="line">cd lci</div>
<div class="line">mkdir build</div>
<div class="line">cmake -DCMAKE_INSTALL_PREFIX=/path/to/install -DLCI_NETWORK_BACKENDS=ofi ..</div>
<div class="line">make</div>
<div class="line">make install</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md47"></a>
Install LCI on a cluster</h3>
<div class="fragment"><div class="line">git clone https://github.com/uiuc-hpc/lci.git</div>
<div class="line">cd lci</div>
<div class="line">mkdir build</div>
<div class="line">cmake -DCMAKE_INSTALL_PREFIX=/path/to/install ..</div>
<div class="line">make</div>
<div class="line">make install</div>
</div><!-- fragment --><p> Basically the same as installing LCI on your laptop, but you don't need to install pre-requisites because they are already installed on the cluster. You also don't need to manually select the network backend because LCI will automatically select the best one for you.</p>
<h3><a class="anchor" id="autotoc_md48"></a>
Important CMake variables</h3>
<ul>
<li><code>LCI_DEBUG=[ON|OFF]</code>: Enable/disable the debug mode (more assertions and logs). The default value is <code>OFF</code>.</li>
<li><code>LCI_NETWORK_BACKENDS=[ibv|ofi]</code>: allow multiple values separated with comma. Hint to which network backend to use. If the backend indicated by this variable are found, LCI will just use it. Otherwise, LCI will use whatever are found with the priority <code>ibv</code> &gt; <code>ofi</code>. The default value is <code>ibv,ofi</code>. Typically, you don't need to modify this variable as if <code>libibverbs</code> presents, it is likely to be the recommended one to use.<ul>
<li><code>ibv</code>: <a href="https://github.com/linux-rdma/rdma-core/blob/master/Documentation/libibverbs.md">libibverbs</a>, typically for infiniband/RoCE.</li>
<li><code>ofi</code>: <a href="https://ofiwg.github.io/libfabric/">libfabric</a>, for all other networks (slingshot-11, ethernet, shared memory).</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md49"></a>
With Spack</h2>
<p>LCI can be installed using <a href="https://spack.io/">Spack</a>. An LCI recipe has been included in the Spack official repository. For the most up-to-date version, you can also use the recipe in the <code>contrib/spack</code> directory of the LCI repository. To install LCI using Spack, run the following commands:</p>
<div class="fragment"><div class="line"># Assume you have already installed Spack</div>
<div class="line"># Optional: add the LCI spack recipe from the LCI repository</div>
<div class="line">git clone https://github.com/uiuc-hpc/lci.git</div>
<div class="line">spack repo add lci/contrib/spack</div>
<div class="line">spack install lci</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md50"></a>
Important Spack variables</h3>
<ul>
<li><code>debug</code>: define the CMake variable <code>LCI_DEBUG</code>.</li>
<li><code>backend=[ibv|ofi]</code>: define the CMake variable <code>LCI_NETWORK_BACKENDS</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md51"></a>
Write LCI programs</h1>
<p>See <code>examples</code> and <code>tests</code> for some example code.</p>
<p>Read <a href="https://jiakunyan.github.io/source/lci_preprint.pdf">this paper</a> to comprehensively understand LCI interface and runtime design.</p>
<p>Check out the API documentation for more details.</p>
<h1><a class="anchor" id="autotoc_md52"></a>
Run LCI applications</h1>
<p>In <a class="el" href="../../d2/dcd/quickstart.html">Quick Start</a>, we have shown you how to run LCI applications using <code>mpirun</code> or <code>srun</code>. Here, we will discuss the bootstrapping process in more detail.</p>
<p>To successfully bootstrap LCI, the launcher (<code>srun</code>, <code>mpirun</code>, or <code>lcrun</code>) must match the bootstrapping backend used by LCI. Normally, LCI will automatically select the right bootstrapping backend based on the environment so no special configuration is needed. However, if you see your applications were launched as a collection of processes all with rank 0, it means something went wrong.</p>
<h3><a class="anchor" id="autotoc_md53"></a>
Bootstrapping backends</h3>
<p>Specifically, LCI has six different bootstrapping backends:</p><ul>
<li><code>pmi1</code>: Process Management Interface version 1.</li>
<li><code>pmi2</code>: Process Management Interface version 2.</li>
<li><code>pmix</code>: Process Management Interface X.</li>
<li><code>mpi</code>: Use MPI to bootstrap LCI.</li>
<li><code>file</code>: LCI-specific bootstrapping backend with a shared file system and <code>flock</code>.</li>
<li><code>local</code>: Just set <code>rank_me</code> to 0 and <code>rank_n</code> to 1.</li>
</ul>
<p><code>pmi1</code>, <code>pmi2</code>, and <code>pmix</code> are the recommended backends to use. They are the same backends used by MPI. The <code>mpi</code> backend is a fallback option if you cannot find the PMI client library. The <code>file</code> backend is a non-scalable bootstrapping backend mainly for testing and debugging purposes.</p>
<p>By default, the source code of LCI is shipped with a copy of the SLURM PMI1 and PMI2 client implementation, so <code>pmi1</code> and <code>pmi2</code> are always compiled. <code>pmix</code> will be compiled if the CMake configuration of LCI finds the PMIx client library. The <code>mpi</code> backend must be explicitly asked for by setting the CMake variable <code>LCT_PMI_BACKEND_ENABLE_MPI=ON</code>. The <code>file</code> and <code>local</code> backend is always compiled.</p>
<p>However, the SLURM PMI1 and PMI2 client implementation is not always the best option. For example, if you are using <code>mpirun</code>, you may want to use the PMI client library that comes with your MPI implementation. In this case, you need to find the corresponding PMI client library and link LCI to it. <code>ldd $(which mpirun)</code> will show you the PMI client library used by <code>mpirun</code>. Normally, MPICH uses <code>hydra-pmi</code>; Cray-MPICH uses <code>cray-pmi</code>; OpenMPI uses <code>pmix</code>. After finding the PMI client library, you can reconfigure LCI with the corresponding PMI client library through the <code>PMI_ROOT</code>, <code>PMI2_ROOT</code>, or <code>PMIx_ROOT</code> environment/cmake variables.</p>
<p>A CMake variable <code>LCT_PMI_BACKEND_DEFAULT</code> and an environment variable <code>LCT_PMI_BACKEND</code> can be used to set a list of backends to try in order (if they are compiled). The first one that works will be used. The default value is <code>pmi1,pmi2,pmix,mpi,file,local</code>.</p>
<p>You can use <code>export LCT_LOG_LEVEL=info</code> to monitor the bootstrapping procedure.</p>
<h3><a class="anchor" id="autotoc_md54"></a>
Launchers</h3>
<p><code>srun</code> and <code>mpirun</code> should use one of the PMI backends (or <code>mpi</code> as a last resort). <code>lcrun</code> will use the <code>file</code> backend.</p>
<p>Depending on the SLURM configuration, <code>srun</code> may not enable PMI by default. In this case, you can explicitly enable one of the PMI services by using the <code>--mpi</code> option. <code>srun --mpi=list -n 1 hostname</code> will show you the available PMI services. You can confirm whether the PMI service has been enabled with <code>srun env | grep PMI</code>.</p>
<p><code>mpirun</code> will use the PMI client library that comes with your MPI implementation. As mentioned above, you need to link LCI to the correct PMI client library.</p>
<p>Sometimes, <code>lcrun</code> may hang because of a previous failed run. In this case, you can remove the temporary folder <code>~/.tmp/lct_pmi_file-*</code> and try again.</p>
<h3><a class="anchor" id="autotoc_md55"></a>
More about the file backend</h3>
<p>The <code>file</code> backend allows you to launch multiple LCI processes individually without a launcher. This can significantly ease the debugging process.</p>
<p>For example, you can open two terminal windows and run the following commands in each window: </p><div class="fragment"><div class="line">export LCT_PMI_BACKEND=file</div>
<div class="line">export LCT_PMI_FILE_NRANKS=2</div>
<div class="line">./lci_program</div>
<div class="line"># or launch it with gdb</div>
<div class="line">gdb ./lci_program</div>
</div><!-- fragment --><p> This will launch two LCI processes with rank 0 and rank 1. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
